# MailSense API Specification

## Base URL
`/api`

## Authentication
All API endpoints require authentication using Bearer tokens.

## Rate Limiting
- 1000 requests per hour per IP address
- 100 requests per minute per user

## Endpoints

### Authentication

#### `POST /api/auth/signin`
Authenticate a user and return JWT token.

**Request Body:**
```json
{
  "email": "{{USER_EMAIL}}",
  "password": "{{USER_PASSWORD}}"
}
```

**Response:**
```json
{
  "token": "{{JWT_TOKEN}}",
  "user": {
    "id": "{{USER_ID}}",
    "email": "{{USER_EMAIL}}",
    "name": "{{USER_NAME}}"
  }
}
```

### Emails

#### `GET /api/emails`
Retrieve a list of emails with pagination and filtering.

**Query Parameters:**
- `page`: Page number (default: 1)
- `limit`: Items per page (default: 20)
- `folder`: Filter by folder (inbox, sent, drafts, etc.)
- `search`: Full-text search query
- `priority`: Filter by priority (high, medium, low)

**Response:**
```json
{
  "emails": [
    {
      "id": "email123",
      "from": "{{SENDER_EMAIL}}",
      "to": ["{{RECIPIENT_EMAIL}}"],
      "subject": "Important Update",
      "snippet": "This is a preview of the email content...",
      "date": "2025-09-15T12:00:00Z",
      "isRead": false,
      "labels": ["work", "important"],
      "priority": "high"
    }
  ],
  "pagination": {
    "total": 150,
    "page": 1,
    "pages": 8,
    "limit": 20
  }
}
```

#### `GET /api/emails/:id`
Get a single email by ID with full content and metadata.

**Response:**
```json
{
  "id": "email123",
  "from": "{{SENDER_EMAIL}}",
  "to": ["{{RECIPIENT_EMAIL}}"],
  "cc": [],
  "bcc": [],
  "subject": "Important Update",
  "body": "<p>Dear User,</p><p>This is the full email content.</p>",
  "date": "2025-09-15T12:00:00Z",
  "isRead": false,
  "labels": ["work", "important"],
  "priority": "high",
  "attachments": [
    {
      "id": "att123",
      "filename": "document.pdf",
      "size": 1024,
      "type": "application/pdf"
    }
  ],
  "aiMetadata": {
    "summary": "Summary generated by AI",
    "sentiment": "positive",
    "keyPoints": ["Point 1", "Point 2"],
    "actionItems": ["Follow up on meeting request"]
  }
}
```

### AI Features

#### `POST /api/ai/summarize`
Generate a summary of the provided text or email content.

**Request Body:**
```json
{
  "content": "Long email content here...",
  "options": {
    "length": "brief",
    "format": "bullet-points"
  }
}
```

**Response:**
```json
{
  "summary": "- Main point 1\n- Main point 2\n- Key takeaway",
  "keyPoints": ["Point 1", "Point 2"],
  "actionItems": ["Action required", "Follow up needed"]
}
```

### WebSocket Events

#### Connection URL
`wss://api.mailsense.app/ws`

**Events:**
- `email:new` - New email received
- `email:updated` - Email status updated
- `notification` - General notification

## Error Handling

All error responses follow this format:
```json
{
  "error": {
    "code": "error_code",
    "message": "Human-readable error message",
    "details": {}
  }
}
```

### Common Error Codes
- `400` - Bad Request
- `401` - Unauthorized
- `403` - Forbidden
- `404` - Not Found
- `429` - Too Many Requests
- `500` - Internal Server Error

## Versioning
API versioning is done through the `Accept` header:
```
Accept: application/vnd.mailsense.v1+json
```

## Rate Limits
- 1000 requests per hour per IP
- 100 requests per minute per user

## Security
- All requests must use HTTPS
- JWT tokens expire after 24 hours
- Password requirements: minimum 12 characters with mixed case, numbers, and symbols
- Rate limiting to prevent abuse
- CORS is enabled for trusted origins only
